{% extends 'base-console.html' %}

{% block title %}
    Add Question
{% endblock title %}

{% block content %}
<div class="container ms-0 mt-0">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Add Question</h5>
    </div>
    <div class="card-body">
      <form method="POST" enctype="multipart/form-data">
        
        <!-- Assessment type -->
        <div class="mb-3">
          <label for="assessment_type" class="form-label fw-semibold">Assessment Type</label>
          <select id="assessment_type" name="assessment_type" class="form-select" required onchange="toggleCorrectInput();toggleImageInputs();">
            <option value="peabody">Peabody Picture Vocabulary Test (PPTV)</option>
            <option value="casl">Comprehensive Assessment of Spoken Language (CASL)</option>
          </select>
        </div>

        <!-- Difficulty -->
        <div class="mb-3">
          <label for="difficulty" class="form-label fw-semibold">Difficulty</label>
          <select id="difficulty" name="difficulty" class="form-select" required>
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>

        <!-- Prompt -->
        <div class="mb-3">
          <label for="prompt" class="form-label fw-semibold">Prompt</label>
          <input type="text" id="prompt" name="prompt" class="form-control" placeholder="Enter the question prompt..." required>
        </div>

        <!-- Dynamic image inputs -->
        <div id="image-inputs-container" class="mb-3"></div>

        <!-- Dynamic correct input -->
        <div id="correct-input-container" class="mb-3"></div>

        <!-- Submit -->
        <div class="text-end">
          <button type="submit" class="btn btn-success">
            Save Question
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function toggleCorrectInput() {
    const type = document.getElementById("assessment_type").value;
    const container = document.getElementById("correct-input-container");

    if (type === "peabody") {
        container.innerHTML = `
          <label class="form-label fw-semibold">Expected Answer</label>
          <select name="correct" class="form-select" required>
            <option value="up">Up</option>
            <option value="down">Down</option>
            <option value="left">Left</option>
            <option value="right">Right</option>
          </select>
        `;
    } else if (type === "casl") {
        container.innerHTML = `
          <label class="form-label fw-semibold">Expected Answer</label>
          <input type="text" name="correct" class="form-control" placeholder="Enter expected answer" required>
        `;
    }
}

function toggleImageInputs() {
    const type = document.getElementById("assessment_type").value;
    const container = document.getElementById("image-inputs-container");

    if (type === "peabody") {
        container.innerHTML = `
          <label class="form-label fw-semibold">Upload Images</label>
          <div class="row g-3">
            ${createImageInput("image_up", "Image Up", "preview_up")}
            ${createImageInput("image_down", "Image Down", "preview_down")}
            ${createImageInput("image_left", "Image Left", "preview_left")}
            ${createImageInput("image_right", "Image Right", "preview_right")}
          </div>
        `;
    } else if (type === "casl") {
        container.innerHTML = `
          <label class="form-label fw-semibold">Upload Images</label>
          <div class="row g-3">
            ${createImageInput("image_left", "Image Left", "preview_left")}
            ${createImageInput("image_right", "Image Right", "preview_right")}
          </div>
        `;
    }
}

function createImageInput(name, label, previewId) {
    return `
      <div class="col-md-6">
        <div class="mb-2">
          <label class="form-label">${label}</label>
          <input type="file" name="${name}" class="form-control" accept="image/*" onchange="previewImage(this, '${previewId}')">
        </div>
        <img id="${previewId}" class="img-thumbnail mt-1 d-none" style="max-height:120px;">
      </div>
    `;
}

// File preview function
function previewImage(input, previewId) {
  const file = input.files[0];
  const preview = document.getElementById(previewId);
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
      preview.classList.remove("d-none");
    }
    reader.readAsDataURL(file);
  } else {
    preview.classList.add("d-none");
  }
}

// Initialize form on page load
window.onload = function() {
    toggleCorrectInput();
    toggleImageInputs();
};
</script>
{% endblock content %}
